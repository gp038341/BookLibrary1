@using BookLibrary.Application.Interfaces
@using BookLibrary.Domain.Entities
@using BookLibrary.Domain.Enums
@inject IBookRepository Repository

@if(Book is not null)
{
	<EditForm method="post" Enhance="true" FormName="AddOrEditBookForm" Model="Book" OnValidSubmit="AddOrEditBook" autocomplete="off">
		<h3>
			@Title
		</h3>
		@if (IsEditMode)
		{
			<input type="hidden" name="Book.Id" value="@Book.Id" />
		}
		<div class="mb-3">
			<label for="title" class="form-label">
				Title
			</label>
			<InputText id="title" @bind-Value="Book.Title" class="form-control shadow-none"></InputText>
		</div>
		<div class="mb-3">
			<label for="author" class="form-label">
				Author
			</label>
			<InputText id="author" @bind-Value="Book.Author" class="form-control shadow-none"></InputText>
		</div>
		<div class="mb-3">
			<label for="pub-date" class="form-label">
				Publication Date
			</label>
			<InputDate id="pub-date" @bind-Value="Book.PublishedDate" class="form-control shadow-none"></InputDate>
		</div>
		<div class="mb-3">
			<label for="genre" class="form-label">
				Genre
			</label>
			<InputSelect id="genre" @bind-Value="Book.Genre" class="form-control shadow-none">
				<option value="0">
					Select Genre
				</option>
				@foreach(var genre in Enum.GetValues(typeof(Genre)))
				{
					<option value="@genre">
						@genre.ToString()
					</option>
				}
			</InputSelect>
		</div>
		<div class="mb-3">
			<button class="btn btn-primary shadow-none">
				Submit
			</button>
			<a href="/" class="btn btn-secondary shadow-none ms-3">
				Back to List
			</a>
		</div>
		<DataAnnotationsValidator/>
		<ValidationSummary />
	</EditForm>
}

@code{
		[Parameter]
		public bool IsEditMode { get; set; } = false;

		[Parameter]
		public int BookId { get; set; }

		[Parameter]
		public EventCallback<Book> OnValidBookSubmit { get; set; }

		[SupplyParameterFromForm]
		public Book? Book { get; set; }

		private string Title => IsEditMode ? $"Edit Book {BookId}" : "Add New Book";

		protected override async Task OnInitializedAsync()
		{
			if (IsEditMode)
			{
				Book ??= await Repository.GetByIdAsync(BookId);
			}
			else
			{
				Book ??= new();
			}
		}
		private async Task AddOrEditBook()
		{
			await OnValidBookSubmit.InvokeAsync(Book);
		}
}